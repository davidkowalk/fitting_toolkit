# fitting_toolkit.fit

The submodule `fit` contains all relevant functions for fitting models.
The functions here are called from `fitting_toolkit.curve_fit`.

## fitting_toolkit.fit.neg_log_likelihood_per_point_yerr

```python
neg_log_likelihood_per_point_yerr(model, theta: np.ndarray, x: np.ndarray, y: np.ndarray, yerror:np.ndarray)
```

Calculates the negative of the natural logarithm of the probability density (likelyhood) that points y are generated by the model using the parameters theta considering only y-errors.

| Parameters | | |
|----------|----------|-----------------|
| **Name** | **Type** | **Description** |
| model    | function | Model to be tested
| theta    | np.ndarray | Parameters of model to be tested
| x        | np.ndarray / float | Values of x-data
| y        | np.ndarray / float | Values of y-data
| yerror   | np.ndarray / float | Standard deviations on y-data

| Parameters | | |
|----------|----------|-----------------|
| **Name** | **Type** | **Description** |
| p        | np.ndarray / float  | Likelyhood for each event

Provides the calculation

$$
-\ln p(y_i | \theta)_{f, \sigma_y} = -\ln \left(\frac{1}{\sqrt{2\pi\sigma_y^2}} \exp\left(-\frac{1}{2} \left(\frac{y_i-f(x_i, \theta)}{\sigma_y}\right)^2\right)\right)\\
=\frac{1}{2}\ln\left({{2\pi\sigma _{y,i}^2}}\right) + \frac{1}{2} \left(\frac{y_i-f(x_i, \theta)}{\sigma _{y,i}}\right)^2
$$

## fitting_toolkit.fit.neg_log_likelihood_per_point_xyerr

```python
neg_log_likelihood_per_point_xyerr(model, theta: np.ndarray, x: np.ndarray, y: np.ndarray, xerror:np.ndarray, yerror:np.ndarray)
```

Calculates the negative of the natural logarithm of the probability density (likelyhood) that points y are generated by the model using the parameters theta considering both x- and y-errors.

| Parameters | | |
|----------|----------|-----------------|
| **Name** | **Type** | **Description** |
| model    | function | Model to be tested
| theta    | np.ndarray | Parameters of model to be tested
| x        | np.ndarray / float | Values of x-data
| y        | np.ndarray / float | Values of y-data
| xerror   | np.ndarray / float | Standard deviations on x-data
| yerror   | np.ndarray / float | Standard deviations on y-data

| Parameters | | |
|----------|----------|-----------------|
| **Name** | **Type** | **Description** |
| p        | np.ndarray / float  | Likelyhood for each event

Note that this function is considerably more computationally expensive than `neg_log_likelihood_per_point_yerr()`.

Provides the calculation

$$
-\ln p(y_i | \theta)_{f, \sigma_y, \sigma_x} = -\ln \int _{-\infty} ^\infty du_i \frac{1}{2\pi\sigma _{y,i}\sigma _{x,i}} \exp\left(-\frac{(y_i-f(u_i, \theta))^2}{2\sigma _{y,i}^2} -\frac{(x_i - u_i)^2}{2\sigma _{x,i}^2}\right)
$$

## fitting_toolkit.fit.neg_log_event_likelyhood
```python
neg_log_likelyhood(theta, model, x, y, yerror, xerror = None)
```

Computes the negative of the natural logarithm of the probability density,
that a model with parameters theta produces the data (x, y).

Standard deviation in y is required, standard deviation in x is optional.
If the error in x is negligable it should be omitted for performance reasons.

| Parameters | | |
|----------|----------|-----------------|
| **Name** | **Type** | **Description** |
| theta    | np.ndarray | Parameters of model to be tested
| model    | function | Model to be tested
| x        | np.ndarray / float | Values of x-data
| y        | np.ndarray / float | Values of y-data
| yerror   | np.ndarray / float | Standard deviations on y-data
| xerror   | np.ndarray / float (optional) | Standard deviations on x-data


| Parameters | | |
|----------|----------|-----------------|
| **Name** | **Type** | **Description** |
| p        | np.ndarray / float  | Likelyhood for each event

While standard deviation in y is required the standard deviation in x is optional. The appropriate function per point is automatically selected. If the error in x is negligable it should be omitted for performance reasons.

## fitting_toolkit.fit.curve_fit_mle
```python
curve_fit_mle(model, xdata: np.array, ydata: np.array, yerror, theta_0 = None, xerror = None)
```
Fits model curve to (xdata, ydata) using maximum likelyhood estimate.
Standard deviation in y is required, standard deviation in x is optional. If the error in x is negligable it should be omitted for performance reasons.

| Parameters | | |
|----------|----------|-----------------|
| **Name** | **Type** | **Description** |
| model    | function | Model to be tested
| x        | np.ndarray / float | Values of x-data
| y        | np.ndarray / float | Values of y-data
| yerror   | np.ndarray / float | Standard deviations on y-data
| xerror   | np.ndarray / float (optional) | Standard deviations on x-data
| theta_0  | np.ndarray (optional) | Initial guess for parameters. If not provided all parameters are initially guessed to be zero.
| **kwargs | | Additional key word arguments passed onto scipy.optimize.minimize


| Parameters | | |
|----------|----------|-----------------|
| **Name** | **Type** | **Description** |
| params   |np.ndarray| Best fit parameters
| cov      |np.ndarray or scipy.sparse.linalg.LinearOperator | Covariance matrix of parameters


## fitting_toolkit.fit.neg_log_event_likelyhood

```py
neg_log_event_likelyhood(model, event, theta)
```

Calculates the element wise likelyhood of a event occuring with a model given the parameters theta.

| Parameters | | |
|----------|----------|-----------------|
| **Name** | **Type** | **Description** |
| model    | function | Model to be tested
| event    | float or np.ndarray | Events for which likelyhood is to be calculated
| theta    | list or list-like | List of parameters used in model


## fitting_toolkit.fit.fit_distribution_anneal
```py
fit_distribution_anneal(model, events, bounds, data_range = None, **kwargs)
```

Finds optimal parameters for probability distribution via maximum likelyhood estimation using simulated annealing.
Let events x be measurements of a random variable which are independent and identically distributed with probability density p(x, *theta).
This function finds the parameters with the highest cumulative negative logarithm of the probability density.


| Parameters | | |
|----------|----------|-----------------|
| **Name** | **Type** | **Description** |
| model    | function | Distribution to be fitted
| events   | np.ndarray| Elements observed
| bounds   | scipy.Bounds or Sequence of (min, max) pairs | Bounds for variables.
| data_range | tuple | Interval in which events are fit.
| **kwargs || Additional arguments passed to scipy.optimize.minimizer

| Returns |||
|---------|----------|-----------------|
| **Name**| **Type** | **Description** |
| params  | np.ndarray | Best fit parameters
| cov     | np.ndarray or scipy.sparse.linalg.LinearOperator | Covariance matrix of parameters